<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ADE - App Development Engine</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    .message-enter-active, .message-leave-active { transition: all 0.3s ease; }
    .message-enter-from { opacity: 0; transform: translateY(10px); }
    .message-leave-to { opacity: 0; transform: translateY(-10px); }
  </style>
  <link rel="stylesheet" crossorigin href="/assets/index-BpYkLeQ_.css">
</head>
<body>
  <div id="app"></div>
  
  <script>
    const { createApp, ref, onMounted, nextTick } = Vue;
    
    createApp({
      setup() {
        const messages = ref([]);
        const userInput = ref('');
        const isConnected = ref(false);
        const ws = ref(null);
        const showChat = ref(false);
        
        const connectWebSocket = () => {
          // For Vercel serverless - no WebSocket needed
          isConnected.value = true;
          console.log('Connected to ADE (Serverless)');
        };
        
        const sendMessage = async () => {
          if (!userInput.value.trim() || !isConnected.value) return;
          
          const messageText = userInput.value;
          userInput.value = '';
          
          messages.value.push({
            type: 'user',
            content: messageText,
            timestamp: Date.now()
          });
          scrollToBottom();
          
          try {
            const response = await fetch('/api/chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: messageText })
            });
            
            const data = await response.json();
            
            messages.value.push({
              type: 'assistant',
              content: data.content,
              timestamp: Date.now()
            });
            scrollToBottom();
          } catch (error) {
            console.error('Chat error:', error);
            messages.value.push({
              type: 'assistant',
              content: 'Sorry, I encountered an error processing your message.',
              timestamp: Date.now()
            });
            scrollToBottom();
          }
        };
        
        const scrollToBottom = () => {
          nextTick(() => {
            const chatContainer = document.getElementById('chat-messages');
            if (chatContainer) {
              chatContainer.scrollTop = chatContainer.scrollHeight;
            }
          });
        };
        
        const startChat = () => {
          showChat.value = true;
          if (!isConnected.value) {
            connectWebSocket();
          }
          
          // Welcome message
          setTimeout(() => {
            messages.value.push({
              type: 'assistant',
              content: 'üëã Hello! I\'m ADE - your App Development Engine. I transform conversations into production-ready apps using APML.\n\nTell me about the app you\'d like to build! For example:\n‚Ä¢ "I need a team messaging app"\n‚Ä¢ "Build a task management tool"\n‚Ä¢ "Create a file sharing platform"',
              timestamp: Date.now()
            });
          }, 500);
        };
        
        onMounted(() => {
          // Auto-connect on page load for demo
          connectWebSocket();
        });
        
        return {
          messages,
          userInput,
          isConnected,
          showChat,
          sendMessage,
          startChat
        };
      },
      
      template: `
        <div class="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 text-white">
          
          <!-- Main Interface -->
          <div v-if="!showChat" class="container mx-auto px-4 py-8">
            <header class="text-center mb-12">
              <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                ADE
              </h1>
              <p class="text-2xl text-gray-300 mb-2">
                App Development Engine
              </p>
              <p class="text-lg text-gray-400">
                Grammar-based app generation ‚Ä¢ THINK ‚Üí FEEL ‚Üí SEE workflow
              </p>
            </header>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16">
              
              <!-- Start New App -->
              <div class="bg-gray-800/50 backdrop-blur p-6 rounded-2xl border border-gray-700/50 text-center">
                <div class="text-4xl mb-4">üöÄ</div>
                <h2 class="text-xl font-bold mb-3 text-green-400">Start New App</h2>
                <p class="text-gray-300 mb-6 text-sm">
                  Begin a conversation with ADE. Describe your idea and watch it become reality.
                </p>
                <button 
                  @click="startChat"
                  class="w-full bg-green-600 hover:bg-green-700 px-4 py-3 rounded-lg font-semibold transition-all"
                >
                  üí¨ Chat with ADE
                </button>
              </div>
              
              <!-- Complete Lifecycle Demo -->
              <div class="bg-gray-800/50 backdrop-blur p-6 rounded-2xl border border-gray-700/50 text-center">
                <div class="text-4xl mb-4">üéØ</div>
                <h2 class="text-xl font-bold mb-3 text-purple-400">Lifecycle Demo</h2>
                <p class="text-gray-300 mb-6 text-sm">
                  See the complete THINK ‚Üí FEEL ‚Üí SEE process using ProjectChat as example.
                </p>
                <a 
                  href="/meta" 
                  class="w-full inline-block bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg font-semibold transition-all"
                >
                  üé¨ View Demo
                </a>
              </div>
              
              <!-- Live Simulator -->
              <div class="bg-gray-800/50 backdrop-blur p-6 rounded-2xl border border-gray-700/50 text-center">
                <div class="text-4xl mb-4">üì±</div>
                <h2 class="text-xl font-bold mb-3 text-blue-400">Live Simulator</h2>
                <p class="text-gray-300 mb-6 text-sm">
                  Experience ProjectChat at real iPhone scale with flow diagrams and compilation.
                </p>
                <a 
                  href="/simulator" 
                  class="w-full inline-block bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-lg font-semibold transition-all"
                >
                  üéÆ Try Simulator
                </a>
              </div>
              
              <!-- APML Tools -->
              <div class="bg-gray-800/50 backdrop-blur p-6 rounded-2xl border border-gray-700/50 text-center">
                <div class="text-4xl mb-4">üîß</div>
                <h2 class="text-xl font-bold mb-3 text-orange-400">APML Tools</h2>
                <p class="text-gray-300 mb-6 text-sm">
                  Upload and visualize APML files. See structure, flows, and validation.
                </p>
                <a 
                  href="/visualizer" 
                  class="w-full inline-block bg-orange-600 hover:bg-orange-700 px-4 py-3 rounded-lg font-semibold transition-all"
                >
                  üìä Open Tools
                </a>
              </div>
            </div>
            
            <!-- Feature Highlights -->
            <section class="text-center mb-16">
              <h2 class="text-3xl font-bold mb-8">Why ADE?</h2>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="p-6">
                  <div class="text-5xl mb-4">‚ö°</div>
                  <h3 class="text-xl font-bold mb-3">Grammar + Examples</h3>
                  <p class="text-gray-400">No searching pattern libraries. Claude knows how to build at any complexity level.</p>
                </div>
                <div class="p-6">
                  <div class="text-5xl mb-4">üß¨</div>
                  <h3 class="text-xl font-bold mb-3">Intent Conservation</h3>
                  <p class="text-gray-400">APML preserves your intent through all transformations. Regeneration always possible.</p>
                </div>
                <div class="p-6">
                  <div class="text-5xl mb-4">üìê</div>
                  <h3 class="text-xl font-bold mb-3">Real iPhone Scale</h3>
                  <p class="text-gray-400">390px drives layout. Experience your app at actual device dimensions.</p>
                </div>
              </div>
            </section>
          </div>
          
          <!-- Chat Interface -->
          <div v-if="showChat" class="h-screen flex flex-col bg-gray-900">
            
            <!-- Chat Header -->
            <header class="bg-gray-800 border-b border-gray-700 p-4 flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <button @click="showChat = false" class="text-gray-400 hover:text-white">
                  ‚Üê Back
                </button>
                <h1 class="text-xl font-bold">ADE Chat</h1>
                <div :class="['w-2 h-2 rounded-full', isConnected ? 'bg-green-500' : 'bg-red-500']"></div>
              </div>
              <div class="text-sm text-gray-400">
                {{ isConnected ? 'Connected' : 'Connecting...' }}
              </div>
            </header>
            
            <!-- Messages -->
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4">
              <transition-group name="message">
                <div 
                  v-for="message in messages"
                  :key="message.timestamp"
                  :class="[
                    'max-w-2xl p-4 rounded-2xl',
                    message.type === 'user' 
                      ? 'bg-blue-600 text-white ml-auto' 
                      : 'bg-gray-800 text-gray-100 mr-auto border border-gray-700'
                  ]"
                >
                  <div class="text-xs opacity-70 mb-2">
                    {{ message.type === 'user' ? 'You' : 'ADE' }}
                  </div>
                  <div class="whitespace-pre-wrap">{{ message.content }}</div>
                </div>
              </transition-group>
            </div>
            
            <!-- Input -->
            <div class="border-t border-gray-700 p-4">
              <div class="flex space-x-3">
                <input
                  v-model="userInput"
                  @keyup.enter="sendMessage"
                  :disabled="!isConnected"
                  placeholder="Describe the app you want to build..."
                  class="flex-1 px-4 py-3 bg-gray-800 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"
                />
                <button
                  @click="sendMessage"
                  :disabled="!isConnected || !userInput.trim()"
                  class="px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-xl font-semibold transition-colors"
                >
                  Send
                </button>
              </div>
            </div>
          </div>
          
        </div>
      `
    }).mount('#app');
  </script>
</body>
</html>